ReadspeakerTlc=(rsTlcEvents=function(){function e(){register.registerTlcClickListenActive(),clickListen.deactivateClickTap()}function t(e){new MutationObserver((function(e,t){for(var r of e)"attributes"===r.type&&"class"==r.attributeName&&r.target.classList.contains("ck-editor__nested-editable_focused")&&!r.target.isContentEditable?r.target.setAttribute("contenteditable",!0):"attributes"===r.type&&"class"==r.attributeName&&r.target.classList.contains("ck-editor__nested-editable_focused")&&n(r)})).observe(e,{attributes:!0,childList:!1,subtree:!1})}function n(e){setTimeout((function(){if(e.target.isContentEditable)return!0;e.target.setAttribute("contenteditable",!0)}),50)}function r(e){var t=this.ckeditorInstance;null!==t&&t.isReadOnly&&(t.isReadOnly=!1)}function i(){e&&clearTimeout(e);var e=setTimeout((function(){var e=new Event("selectionEnd");document.dispatchEvent(e)}),500)}function s(e,t){var n=window.getSelection().toString();if(""!=n){rspkr.ui.setPointerPos(e),rspkr.c.data.setSelectedText(e),rspkr.popup.lastSelectedText=n;var r=new rspkr.lib.Facade.RSEvent;r.clientX=e.layerX,r.clientY=e.layerY,r.keyCode=void 0,r.originalEvent=e,r.pageX=e.pageX,r.pageY=e.pageY,r.screenX=e.layerX,r.screenY=e.layerY,r.target=document,r.targetTouches=void 0,r.type=t,rspkr.rs_popup_modified=!1,rspkr.popup.showPopup(r)}}return{handleTextBoxFocusForReadspeaker:function(t,n){e();var r=popup.getRsbtnPopupTlc(n,t,{x:-16,y:-16});null!=r&&(t.target,r.addEventListener("click",read.readTextbox,{once:!0}))},handleTextBoxBlurForReadspeaker:function(e,t){popup.rsRemovRsbtnPopupTlcForQuestion(e,t)},rsFocusSelect:function(e,t,n){register.registerTlcClickListenActive();var r=popup.getRsbtnPopupTlc(n,e,{x:-16,y:-16});null!=r&&r.addEventListener("click",util.showReadableSelect,!1)},rsBlurSelect:function(e,t){popup.rsRemovRsbtnPopupTlcForQuestion(e,t)},handleTextareaFocusForReadspeaker:function(t,n){e();var r=popup.getRsbtnPopupTlc(n,t,{x:-15,y:6});null!=r&&(t.target,r.addEventListener("click",read.readTextArea,{once:!0}))},handleTextareaBlurForReadspeaker:function(e,t){popup.rsRemovRsbtnPopupTlcForQuestion(e,t)},handleCkeditorFocusForReadspeaker:function(t,n,r){if(!popup.alreadyThere(n)&&!rspkr.rs_tlc_prevent_ckeditor_focus){e(),t.editorId=r;var i=popup.getRsbtnPopupTlcElement(n,t,{x:-15,y:-16});null!=i&&i.addEventListener("click",read.readCkeditor,{once:!0})}},handleCkeditorBlurForReadspeaker:function(e,t,n){popup.rsRemovRsbtnPopupTlcForElement(e,t)},handleCkeditorSelectionChangeDoneForReadspeaker:function(e){e.editing.view.document.on("selectionChangeDone",(()=>{var t=e.model.document.selection.getFirstRange();if(t.end.isEqual(t.start))return clearTimeout(RichTextEditor.timer),rspkr.rs_tlc_ckeditor_selecting=!1,void(e.isReadOnly=!1);var n=e.ui.view.editable.element;rspkr.rs_tlc_ckeditor_selecting=!1,n.addEventListener("click",r)}))},handleCkeditorSelectionChangeForReadspeaker:function(e){e.editing.view.document.on("selectionChange",(()=>{rspkr.rs_tlc_ckeditor_selecting=!0,RichTextEditor.timer=setTimeout(RichTextEditor.setReadOnly.bind(null,e),50)}))},handleIPadSelectionChange:function(){util.isIpadOS()&&(document.addEventListener("touchend",(function(e){setTimeout(s(e,"touchend"),100)})),util.isIOS12()&&(console.dir("ios12"),document.addEventListener("selectionchange",i),document.addEventListener("selectionEnd",(function(e){setTimeout(s(e,"touchend"),100)}))))},handlePopupChange:function(){var e={attributes:!0,childList:!1,subtree:!1},t=document.querySelector("#rsbtn_popup");new MutationObserver((function(e,t){for(var n of e)if("attributes"===n.type&&"style"==n.attributeName)for(const e in ClassicEditors)try{if(!util.checkElementInActiveQuestion(ClassicEditors[e].ui.view.editable.element))return!0;var r=ClassicEditors[e].model.document.selection.getFirstRange();if(r.end.isEqual(r.start))return!0;ClassicEditors[e].isReadOnly=!1,ClassicEditors[e].ui.view.editable.element.classList.contains("ck-blurred")&&ClassicEditors[e].ui.view.editable.element.focus()}catch(e){return console.dir(e),!0}})).observe(t,e),new MutationObserver((function(e,t){if(rspkr.rs_popup_modified)return!0;for(var n of e)"attributes"===n.type&&"style"==n.attributeName&&util.isIpadOS()&&popup.positionBySelection()})).observe(t,e)},addListenersToPopup:function(){document.querySelector("#rsbtn_popup")&&ReadspeakerTlc.rsTlcEvents.handlePopupChange();var e=document.querySelector("body");new MutationObserver((function(e,t){for(var n of e)"childList"==n.type&&void 0!==n.addedNodes&&void 0!==n.addedNodes[0]&&"rsbtn_popup"==n.addedNodes[0].id&&(ReadspeakerTlc.rsTlcEvents.handlePopupChange(),!rspkr.rs_popup_modified&&util.isIpadOS()&&popup.positionBySelection())})).observe(e,{attributes:!0,childList:!0,subtree:!1})},handleCkeditorTableCellFocusForReadspeaker:t,addListenerCkeditorTableCellFocusForReadspeaker:function(e){var n=document.evaluate(".//td[contains(@class, 'ck-editor__nested-editable')]",e,null,XPathResult.ANY_TYPE,null);try{for(var r=n.iterateNext();r;)t(r),r=n.iterateNext()}catch(e){console.dir("Error: Document tree modified during iteration "+e)}}}}(),clickListen={activateClickTap:function(){rspkr.ui.Tools.ClickListen.active()||rspkr.ui.Tools.ClickListen.activate()},deactivateClickTap:function(){rspkr.ui.Tools.ClickListen.active()&&rspkr.ui.Tools.ClickListen.deactivate()}},hiddenElement=function(){function e(){if(!rspkr.rs_tlc_play_started){var e=document.getElementById("there_can_only_be_one");e&&e.remove()}}function t(e){if(e&&("INPUT"!=e.nodeName||""!=e.value)){var t=document.createElement("div");e.parentNode.insertBefore(t,e),t.id="there_can_be_more_than_one_"+e.id,"INPUT"==e.nodeName&&(t.innerHTML=e.value,t.classList.add("rs-shadow-input")),"SELECT"==e.nodeName&&(t.innerHTML=e.title,""==e.title&&(t.innerHTML=e.firstChild.innerHTML),t.classList.add("rs-shadow-select")),t.style.height=e.offsetHeight+"px",t.style.width=e.offsetWidth+"px",t.style.display="inline-flex",t.classList.add("form-input"),t.classList.add("overflow-ellipsis"),t.classList.add("readspeaker_readable_element"),e.classList.add("hidden"),e.classList.add("rs_skip"),e.classList.add("readspeaker_hidden_element")}}function n(e){if(!document.getElementById("there_can_only_be_one")){var t="there_can_be_more_than_one_"+e.id,n=document.querySelector("#"+t);n&&n.remove(),e.classList.contains("hidden")&&e.classList.remove("hidden"),e.classList.contains("readspeaker_hidden_element_multiple")&&e.classList.remove("readspeaker_hidden_element_multiple"),e.classList.contains("readspeaker_hidden_element")&&e.classList.remove("readspeaker_hidden_element"),e.classList.contains("rs_skip")&&e.classList.remove("rs_skip")}}return{removeOldElement:e,removeReadableElements:function(){for(var e=document.getElementsByClassName("readspeaker_readable_element"),t=0;t<e.length;t++)e[t].remove()},cloneHiddenSpan:function(e){var t=document.getElementById("hidden_span_"+e.name).cloneNode(!0);return t.id="there_can_only_be_one",t.classList.remove("hidden"),document.getElementById(e.id+"_contents").appendChild(t),t},displayHiddenElementsAndRemoveTheRest:function(){e(),document.getElementById("there_can_only_be_one")||void 0!==rspkr.rs_tlc_play_started&&(rspkr.rs_tlc_play_started||function(){if(rspkr.rs_tlc_container){var e=rspkr.rs_tlc_container._x_refs;if(e)for(var t=Object.entries(e),r=0;r<t.length;r++)n(t[r][1])}}())},getReadableDivForSelect:function(t){e();var n=document.createElement("div");n.id="there_can_only_be_one";var r=document.createElement("ul");n.appendChild(r);for(var i=0;i<t.options.length;i++){var s=document.createElement("li");s.innerHTML=t.options[i].innerHTML,r.appendChild(s)}return n.classList.add("rs-shadow-select-popup"),n.classList.add("overflow-ellipsis"),n.classList.add("rs-click-listen"),n},createHiddenDivsForSelects:function(e){var n=document.querySelector("#"+e);if(n){var r=n._x_refs;if(r){rspkr.rs_tlc_container=n;for(var i=Object.entries(r),s=0;s<i.length;s++)t(i[s][1])}}},createHiddenDivTextArea:function(t){var n=function(t){var n,r=document.getElementById("there_can_only_be_one"),i=!1;return r&&(i=r.nextElementSibling),i.id==t.id?n=r:(e(),n=document.createElement("div")),n}(t),r=t.closest(".open-question-container");return r&&(rspkr.rs_tlc_container=r),n.id="there_can_only_be_one",n.innerHTML=t.value,n.style.height=t.offsetHeight+"px",n.style.width=t.offsetWidth+"px",n.classList.add("rs-shadow-textarea"),n.classList.add("form-input"),n.classList.add("overflow-ellipsis"),n.classList.add("rs-click-listen"),t.parentNode.insertBefore(n,t),t.classList.add("hidden"),t.classList.add("readspeaker_hidden_element"),n},createHiddenDivsForTextboxesCompletion:function(e){var n=document.querySelector("#"+e);if(n){var r=n._x_refs;if(r){rspkr.rs_tlc_container=n;for(var i=Object.entries(r),s=0;s<i.length;s++)t(i[s][1])}}}}}(),register={registerTlcClickListenActive:function(){rspkr.tlc_clicklisten_active=rspkr.ui.Tools.ClickListen.active()}},read=function(){function e(e){if(""==e||null==e)return!0;try{if(e.matches(":-internal-autofill-selected")&&""!=e.title)return!1}catch(e){}try{if(e.matches(":-webkit-autofill")&&""!=e.title)return!1}catch(e){}try{if(e.matches(":autofill")&&""!=e.title)return!1}catch(e){}return""==e.title&&""==e.value}return{readTextbox:function(t){popup.hideRsTlcPopup(this);var n=this.linkedElement;if(hiddenElement.removeOldElement(),rspkr.rs_tlc_play_started=!1,rspkr.rs_tlc_prevent_close=!0,!e(n)){var r=document.createElement("div");n.parentNode.insertBefore(r,n),r.id="there_can_only_be_one",r.innerHTML=function(e){return""==e||null==e?"":e.title}(n),r.style.height=n.offsetHeight+"px",r.style.width=n.offsetWidth+"px",r.style.display="inline-flex",r.classList.add("rs-click-listen"),r.classList.add("rs-shadow-input"),r.classList.add("form-input"),r.classList.add("overflow-ellipsis"),n.classList.add("hidden"),n.classList.add("readspeaker_hidden_element");var i=n.closest(".completion-question-container");i&&(rspkr.rs_tlc_container=i),clickListen.activateClickTap(),r.click()}},doNotReadInput:e,readTextArea:function(e){if(popup.hideRsTlcPopup(this),!rspkr.rs_tlc_play_started){clickListen.activateClickTap(),rspkr.rs_tlc_play_started=!1,rspkr.rs_tlc_prevent_close=!0;var t=this.linkedElement;hiddenElement.createHiddenDivTextArea(t).click()}},readCkeditor:function(e){if(popup.hideRsTlcPopup(this),!rspkr.rs_tlc_play_started){clickListen.activateClickTap(),rspkr.rs_tlc_play_started=!1,rspkr.rs_tlc_prevent_close=!0,rspkr.rs_tlc_prevent_ckeditor_focus=!0;var t=this.linkedElement;null!=t&&t.click()}}}}(),popup=function(){function e(e,t,n){var r=document.querySelector(".rsbtn_popup_tlc_"+e);if(null==r)return r;r.classList.contains("hidden")&&r.classList.remove("hidden");var i=t.getBoundingClientRect();switch(document.body.offsetHeight,window.innerHeight,t.nodeName){case"INPUT":case"SELECT":var s=t.nextElementSibling;if("SPAN"!=s.nodeName)return;s.append(r),r.style.left=n.x+"px",r.style.top=n.y+"px";break;case"DIV":case"TEXTAREA":r.style.left=i.width+n.x+"px",r.style.top=n.y+"px"}return r.linkedElement=t,r}function t(e,t){t.target==e.linkedElement&&n(e)}function n(e){switch(e.classList.contains("hidden")||e.classList.add("hidden"),e.linkedElement.nodeName){case"TEXTAREA":e.removeEventListener("click",read.TextArea);break;case"INPUT":e.removeEventListener("click",read.TextBox);break;case"SELECT":e.removeEventListener("click",read.readSelect);break;case"DIV":e.removeEventListener("click",read.readCkeditor);break;default:e.removeEventListener("click")}}return{getRsbtnPopupTlc:function(t,n,r){return e(t,n.currentTarget,r)},rsRemovRsbtnPopupTlcForQuestion:function(e,n){var r=document.querySelector(".rsbtn_popup_tlc_"+n);null!=r&&e.target==r.linkedElement&&setTimeout(t.bind(null,r,e),500)},hideRsTlcPopup:n,getRsbtnPopupTlcElement:e,rsRemovRsbtnPopupTlcForElement:function(e,t){var r=document.querySelector(".rsbtn_popup_tlc_"+t);null!=r&&setTimeout(n.bind(null,r),500)},alreadyThere:function(e){var t=document.querySelector(".rsbtn_popup_tlc_"+e);return null!=t&&!t.classList.contains("hidden")},positionBySelection:function(){s=window.getSelection(),""!=s.toString()&&(oRange=s.getRangeAt(0),oRect=oRange.getBoundingClientRect(),document.querySelector("#rsbtn_popup").style.top=oRect.y+60+"px",rspkr.rs_popup_modified=!0)}}}(),player=function(){function e(){util.hideByClassName("rs_starter_button"),util.showById("readspeaker_button1")}return{hideRsPlayer:function(){rspkr.rs_tlc_prevent_close||(util.showByClassName("rs_starter_button"),util.hideById("readspeaker_button1"),rspkr.rs_tlc_play_started=!1,hiddenElement.displayHiddenElementsAndRemoveTheRest())},showRsPlayer:e,startRsPlayer:function(){e();var t=document.getElementsByClassName("rsplay");t&&[].forEach.call(t,(function(e){e.click()}))},sliderForIpad:function(){if(util.isIpadOS()){var e=document.querySelector(".rsbtn_speed_slider");e.classList.contains("mouse-controlled")||e.classList.add("mouse-controlled")}}}}(),util=function(){function e(){return["iPad Simulator","iPhone Simulator","iPod Simulator","iPad","iPhone","iPod"].includes(navigator.platform)||navigator.maxTouchPoints&&navigator.maxTouchPoints>2&&/MacIntel/.test(navigator.platform)}return{showById:function(e){var t=document.getElementById(e);t&&t.classList.remove("hidden")},hideById:function(e){var t=document.getElementById(e);t&&t.classList.add("hidden")},showByClassName:function(e){var t=document.getElementsByClassName(e);t&&[].forEach.call(t,(function(e){e.classList.remove("hidden")}))},hideByClassName:function(e){var t=document.getElementsByClassName(e);t&&[].forEach.call(t,(function(e){e.classList.add("hidden")}))},checkPossibleTextAreaValid:function(e){return null!=e&&"TEXAREA"==e.nodeName},checkPossibleTextAreaAlreadyExists:function(e,t){return e.id==t},checkElementInActiveQuestion:function(e){return!!e.closest(".rs_readable")},showReadableSelect:function(e){rspkr.rs_tlc_prevent_close=!0,clickListen.activateClickTap();var t=hiddenElement.getReadableDivForSelect(this.linkedElement);this.parentNode.insertBefore(t,this),t.style.position="absolute",popup.hideRsTlcPopup(this),t.click()},isIpadOS:e,isIOS12:function(){return e()&&!(navigator.maxTouchPoints&&navigator.maxTouchPoints>2&&/MacIntel/.test(navigator.platform))}}}(),ckeditor={disableContextMenuOnCkeditor:function(){var e=document.getElementsByClassName("ck-editor__editable_inline")[0];e&&e.addEventListener("contextmenu",((e,t,n)=>(e.preventDefault(),!1)))},shouldNotReinitCkeditor:function(e){return!util.checkElementInActiveQuestion(e)},detachReadableAreaFromCkeditor:function(e){var t=ClassicEditors[e];t.currentElement=t.ui.view.editable.element;var n=t.ui.view.editable.element;if(n){var r=n.cloneNode(!0);r.classList.add("ck-editor__editable_inline_replaced"),n.replaceWith(r)}return window.classicEditorDetached=!0,n},addListenersForReadspeaker:function(e,t,n){var r=e.ui.view.editable.element;new MutationObserver((function(e,r){for(var i of e)if("attributes"===i.type)if("class"==i.attributeName&&i.target.classList.contains("ck-focused"))rsTlcEvents.handleCkeditorFocusForReadspeaker(i.target,t,n);else if("class"==i.attributeName&&i.target.classList.contains("ck-blurred")){if(i.target.ckeditorInstance&&i.target.ckeditorInstance.isReadOnly)return;rsTlcEvents.handleCkeditorBlurForReadspeaker(i.target,t,n)}})).observe(r,{attributes:!0,childList:!1,subtree:!1}),rsTlcEvents.handleCkeditorSelectionChangeDoneForReadspeaker(e),rsTlcEvents.handleCkeditorSelectionChangeForReadspeaker(e),r.querySelector("figure")&&rsTlcEvents.addListenerCkeditorTableCellFocusForReadspeaker(r.querySelector("figure"));var i=e.ui.view.editable.element;new MutationObserver((function(e,t){for(var n of e)"childList"==n.type&&void 0!==n.addedNodes&&void 0!==n.addedNodes[0]&&"figure"==n.addedNodes[0].nodeName.toLowerCase()&&rsTlcEvents.addListenerCkeditorTableCellFocusForReadspeaker(n.addedNodes[0])})).observe(i,{attributes:!1,childList:!0,subtree:!1})},reattachReadableAreaAndDestroy:function(e){window.classicEditorDetached=!1;var t=ClassicEditors[e];if(t){var n=document.getElementsByClassName("ck-editor__editable_inline_replaced")[0];n&&(n.replaceWith(t.currentElement),t.destroy(!0))}}},guard=function(){function e(e){if(document.getElementById("there_can_only_be_one"))return!0;var t=document.querySelector("#"+e);return!(!t||util.checkElementInActiveQuestion(t))}return{shouldNotCreateHiddenTextarea:function(e){var t=document.getElementById("there_can_only_be_one"),n=!1,r="textarea_"+e,i=document.querySelector("#"+r);return!((!i||util.checkElementInActiveQuestion(i))&&(t&&(n=t.nextElementSibling),(!n||util.checkElementInActiveQuestion(t))&&(!n||util.checkPossibleTextAreaValid(n))&&(!n||!util.checkPossibleTextAreaAlreadyExists(n,r))))},shouldNotCreateHiddenDivsForSelects:function(t){return e(t)},shouldNotCreateHiddenDivsForTextboxesCompletion:function(t){return e(t)},shouldNotReinitCkeditor:function(e){return!window.classicEditorDetached||!util.checkElementInActiveQuestion(e)},shouldNotDetachCkEditor:function(e){return!util.checkElementInActiveQuestion(e)}}}(),{rsTlcEvents:rsTlcEvents,player:player,guard:guard,clickListen:clickListen,ckeditor:ckeditor,hiddenElement:hiddenElement,register:register}),ReadSpeaker.q((function(){console.log("rs_tlc initialized!"),rspkr.rs_tlc_play_started=!1,ReadspeakerTlc.register.registerTlcClickListenActive(),rspkr.rs_tlc_prevent_close=!1,rspkr.rs_tlc_container=!1,rspkr.rs_tlc_prevent_ckeditor_focus=!1,rspkr.rs_tlc_ckeditor_selecting=!1,rspkr.rs_popup_modified=!1,ReadspeakerTlc.rsTlcEvents.handleIPadSelectionChange(),ReadspeakerTlc.rsTlcEvents.addListenersToPopup()})),window.rsConf={general:{usePost:!0,skipHiddenContent:!0},ui:{scrollcontrols:{vertical:"top",horizontal:"left"},toolbar:{inverted:!1},tools:{textmode:!1},mobileVertPos:"bottom=100"},cb:{ui:{beforeclose:function(){var e=document.getElementsByClassName("rs-cl-tabbable");void 0!==e.length&&0!=e.length&&e[0].classList.remove("rs-cl-tabbable")},close:function(){console.log("Player closed and callback fired!"),ReadspeakerTlc.clickListen.deactivateClickTap(),ReadspeakerTlc.player.hideRsPlayer(),rspkr.rs_tlc_prevent_ckeditor_focus=!1,window.document.dispatchEvent(new Event("readspeaker_closed",{bubbles:!0,cancelable:!0}))},stop:function(){console.log("Player stopped and callback fired!"),ReadspeakerTlc.clickListen.deactivateClickTap(),rspkr.ui.getActivePlayer().close()},open:function(){console.log("Open callback fired!"),window.document.dispatchEvent(new Event("readspeaker_opened",{bubbles:!0,cancelable:!0}))},play:function(){console.log("Play callback fired!"),rspkr.rs_tlc_play_started=!0,rspkr.rs_tlc_prevent_close=!1,ReadspeakerTlc.player.showRsPlayer(),window.document.dispatchEvent(new Event("readspeaker_started",{bubbles:!0,cancelable:!0})),ReadspeakerTlc.player.sliderForIpad()},pause:function(){console.log("Pause callback fired!"),rspkr.rs_tlc_play_started=!1}}}},window.classicEditorDetached=!1;
