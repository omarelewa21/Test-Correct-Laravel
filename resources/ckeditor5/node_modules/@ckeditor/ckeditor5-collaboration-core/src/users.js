/*
 *             Copyright (c) 2016 - 2022, CKSource Holding sp. z o.o. All rights reserved.
 *
 *
 *
 *
 *          +---------------------------------------------------------------------------------+
 *          |                                                                                 |
 *          |                                 Hello stranger!                                 |
 *          |                                                                                 |
 *          |                                                                                 |
 *          |   What you're currently looking at is the source code of a legally protected,   |
 *          |    proprietary software. Any attempts to deobfuscate / disassemble this code    |
 *          |               are forbidden and will result in legal consequences.              |
 *          |                                                                                 |
 *          |                                                                                 |
 *          +---------------------------------------------------------------------------------+
 *
 *
 *
 *
 */
import{ContextPlugin as _0x2bacea}from'ckeditor5/src/core';import{Collection as _0x43d56d,CKEditorError as _0x1cf0a4}from'ckeditor5/src/utils';import _0x355f10 from'./permissions';import'../theme/usercolors.css';export default class r extends _0x2bacea{static get['pluginName'](){return'Users';}static get['requires'](){return[_0x355f10];}constructor(_0x4a5287){super(_0x4a5287),_0x4a5287['config']['define']('users.anonymousUserId','anonymous-user'),_0x4a5287['config']['define']('users.colorsCount',0x8),this['users']=new _0x43d56d(),this['_locale']=_0x4a5287['locale'],this['_licenseKeyCheckInterval']=null,this['_lastColor']=0x0,this['_myId']=null,this['decorate']('getOperationAuthor');}['init'](){const _0x3a877f=this['context'];this['licenseKey']=_0x3a877f['config']['get']('licenseKey'),this['_licenseKeyCheckInterval']=setInterval(()=>{let _0x414a18;for(const _0x144372 in _0x3a877f){const _0x43e571=_0x3a877f[_0x144372];if('licenseKeyTrial'===_0x43e571||'licenseKeyInvalid'===_0x43e571||'licenseKeyValid'===_0x43e571||'licenseKeyTrialLimit'==_0x43e571){delete _0x3a877f[_0x144372],_0x414a18=_0x43e571;break;}}if('licenseKeyInvalid'===_0x414a18)throw clearInterval(this['_licenseKeyCheckInterval']),new _0x1cf0a4('invalid-license-key',null);if('licenseKeyTrial'===_0x414a18&&console['info']('You\x20are\x20using\x20the\x20trial\x20version\x20of\x20CKEditor\x205\x20collaboration\x20plugin\x20with\x20limited\x20usage.\x20Make\x20sure\x20you\x20will\x20not\x20use\x20it\x20in\x20the\x20production\x20environment.'),'licenseKeyTrialLimit'===_0x414a18)throw clearInterval(this['_licenseKeyCheckInterval']),new _0x1cf0a4('trial-license-key-reached-limit',null);'licenseKeyValid'===_0x414a18&&clearInterval(this['_licenseKeyCheckInterval']);},0x3e8),this['_addAnonymousUser']();}get['me'](){return null==this['_myId']?null:this['getUser'](this['_myId']);}['addUser'](_0x21634b){if(!(_0x21634b=Object['assign']({},_0x21634b,{'color':this['_getNextColor']()}))['id']||'string'!=typeof _0x21634b['id'])throw new _0x1cf0a4('users-add-invalid-id');if(this['users']['has'](_0x21634b['id']))throw new _0x1cf0a4('users-add-duplicated-id',null,{'id':_0x21634b['id']});_0x21634b['name']=function(_0x4e5621,_0x41c002=''){const {t:t}=_0x4e5621;return''==(_0x41c002=_0x41c002['trim']())?t('Anonymous'):_0x41c002;}(this['_locale'],_0x21634b['name']);const _0x3748c9=new l(_0x21634b);return this['users']['add'](_0x3748c9),_0x3748c9;}['getUser'](_0x831d0b){return this['users']['get'](_0x831d0b);}['useAnonymousUser'](){const _0x33ad75=this['context']['config']['get']('users.anonymousUserId');this['_myId']||this['defineMe'](_0x33ad75);}['defineMe'](_0x425ad9){if(this['_myId'])throw new _0x1cf0a4('users-me-already-defined',null);if(!this['getUser'](_0x425ad9))throw new _0x1cf0a4('users-me-missing-user',null);this['_myId']=_0x425ad9;}['getOperationAuthor'](){return this['me'];}['destroy'](){super['destroy'](),clearInterval(this['_licenseKeyCheckInterval']);}['_getNextColor'](){const _0x345a62=this['context']['config']['get']('users.colorsCount');return this['_lastColor']>=_0x345a62&&(this['_lastColor']=0x0),new u(this['_lastColor']++);}['_addAnonymousUser'](){const {t:t}=this['_locale'],_0x2dc9b1=this['context']['config']['get']('users.anonymousUserId');this['addUser']({'id':_0x2dc9b1,'name':t('Anonymous')})['_isAnonymous']=!0x0;}}class l{constructor(_0x4c482a){this['id']=_0x4c482a['id'],this['color']=_0x4c482a['color'],this['name']=_0x4c482a['name'],this['avatar']=_0x4c482a['avatar'],this['_isAnonymous']=!0x1;}get['isAnonymous'](){return this['_isAnonymous'];}get['initials'](){const _0xd04941=this['name']['split']('\x20');return 0x1===_0xd04941['length']?this['_getInitial'](_0xd04941[0x0]):this['_getInitial'](_0xd04941[0x0])+this['_getInitial'](_0xd04941[_0xd04941['length']-0x1]);}['_getInitial'](_0x128ac0){return _0x128ac0['charAt'](0x0)['toUpperCase']();}}class u{constructor(_0x34adda){this['_id']=_0x34adda;}['getBackgroundColorClass'](){return'ck-user__bg-color--'+this['_id'];}['getSelectionClass'](){return'ck-user__selection--'+this['_id'];}['getMarkerClass'](){return'ck-user__marker--'+this['_id'];}}