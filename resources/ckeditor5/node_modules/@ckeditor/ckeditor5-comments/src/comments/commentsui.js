/*
 *             Copyright (c) 2016 - 2022, CKSource Holding sp. z o.o. All rights reserved.
 *
 *
 *
 *
 *          +---------------------------------------------------------------------------------+
 *          |                                                                                 |
 *          |                                 Hello stranger!                                 |
 *          |                                                                                 |
 *          |                                                                                 |
 *          |   What you're currently looking at is the source code of a legally protected,   |
 *          |    proprietary software. Any attempts to deobfuscate / disassemble this code    |
 *          |               are forbidden and will result in legal consequences.              |
 *          |                                                                                 |
 *          |                                                                                 |
 *          +---------------------------------------------------------------------------------+
 *
 *
 *
 *
 */
import{Plugin as _0x4330b2}from'ckeditor5/src/core';import _0x44f7c7 from'./commentsrepository';import _0x864cc5 from'./commentsediting';import _0xa51286 from'../annotations/editorannotations';import{ButtonView as mt}from'ckeditor5/src/ui';import at from'../../theme/icons/add-comment.svg';import _0x2ba08f from'../annotations/annotations';export default class n extends _0x4330b2{static get['pluginName'](){return'CommentsUI';}static get['requires'](){return[_0x44f7c7,_0x864cc5,_0xa51286,_0x2ba08f];}['init'](){const _0x53cedc=this['editor'],_0x2af0f8=_0x53cedc['plugins']['get'](_0x44f7c7),_0xe1b32b=_0x53cedc['plugins']['get'](_0x864cc5),_0x149de4=_0x53cedc['plugins']['get'](_0x2ba08f),_0x125402=_0x53cedc['plugins']['get'](_0xa51286);_0x53cedc['ui']['componentFactory']['add']('comment',()=>this['_createUIButton']()),_0x125402['addSourceCollector'](()=>{const _0x41f5a2=[];for(const [_0x5bc8f2,_0xbcc0b4]of _0x2af0f8['_threadToController']){const _0x50b00a=_0xe1b32b['getAllMarkersForId'](_0x5bc8f2['id']),_0xf0e27d=_0x50b00a['map'](_0x18da05=>_0x18da05['getRange']());_0x50b00a['length']>0x0&&_0x41f5a2['push']([_0xbcc0b4['view'],_0xf0e27d]);}return _0x41f5a2;}),this['listenTo'](_0x149de4,'change:activeAnnotations',(_0x26aae5,_0xdfb469,_0x1afacb)=>{const _0x48a613=Array['from'](_0x1afacb)['map'](_0x5007f1=>_0x5007f1['innerView'])['find'](_0x2f7b17=>_0x2af0f8['_viewToController']['has'](_0x2f7b17));if(!_0x48a613)return void(_0xe1b32b['activeMarker']=null);const _0x25b002=_0x2af0f8['_viewToController']['get'](_0x48a613)['model']['id'],_0x1e688a='comment:'+_0x25b002;_0xe1b32b['hasMarkerForId'](_0x25b002)?_0xe1b32b['activeMarker']=_0x1e688a:_0xe1b32b['activeMarker']&&(_0xe1b32b['activeMarker']=null);}),this['listenTo'](_0x2af0f8,'removeCommentThread',(_0x52c8a1,{threadId:_0x2fcd52,isFromAdapter:_0x57ef1c})=>{!_0x57ef1c&&_0x53cedc['ui']['focusTracker']['isFocused']&&_0xe1b32b['hasMarkerForId'](_0x2fcd52)&&_0x53cedc['editing']['view']['focus']();},{'priority':'highest'}),this['listenTo'](_0x2af0f8,'addComment',(_0x2532c8,{threadId:_0x4a28a2,isFromAdapter:_0x340487})=>{if(_0x340487||!_0xe1b32b['hasMarkerForId'](_0x4a28a2)||!_0x2af0f8['hasCommentThread'](_0x4a28a2))return;0x1===_0x2af0f8['getCommentThread'](_0x4a28a2)['length']&&(_0x53cedc['editing']['view']['focus'](),_0x2532c8['stop']());},{'priority':'low'});}['_createUIButton'](){const _0x1db39e=this['editor'],_0x21070d=new mt(_0x1db39e['locale']),_0x3c32e2=_0x1db39e['commands']['get']('addCommentThread'),{t:t}=this['editor']['locale'];return _0x21070d['label']=t('Comment'),_0x21070d['tooltip']=t('Comment'),_0x21070d['icon']=at,_0x21070d['bind']('isEnabled')['to'](_0x3c32e2),this['listenTo'](_0x21070d,'execute',()=>_0x3c32e2['execute']()),_0x21070d;}}