/*
 *             Copyright (c) 2016 - 2022, CKSource Holding sp. z o.o. All rights reserved.
 *
 *
 *
 *
 *          +---------------------------------------------------------------------------------+
 *          |                                                                                 |
 *          |                                 Hello stranger!                                 |
 *          |                                                                                 |
 *          |                                                                                 |
 *          |   What you're currently looking at is the source code of a legally protected,   |
 *          |    proprietary software. Any attempts to deobfuscate / disassemble this code    |
 *          |               are forbidden and will result in legal consequences.              |
 *          |                                                                                 |
 *          |                                                                                 |
 *          +---------------------------------------------------------------------------------+
 *
 *
 *
 *
 */
const _0x5a7d=['managedUsingOperations','left','stop','markers','getAllMarkersForId','change:isThreadsLoadingPaused','isThreadsLoadingPaused','root','elementToElement','init','once','model','pluginName','markerToData','CommentsEditing','_attachedThreads','change','plugins','dataToMarker','CommentsRepository','document','add','_attachThreadToMarker','collaboration.channelId','newRange','fetchCommentThread','hasCommentThread','createPositionBefore','openNewCommentThread','has','view','getAttribute','length','removeMarker','addCommentThread','switchReadOnly','editingDowncast','start','updateMarker','for','_initializeMarkerConverters','isCollapsed','name','editing','schema','change:isReadOnly','$graveyard','requires','differ','set','_handleMarkerAddAndRemove','delete','conversion','createRange','ck-comment-marker--active','markerToHighlight','low','affectsData','high','from','attachTo','getWalker','push','size','dataDowncast','hasMarkerForId','listenTo','upcast','commands','addComment','config','isEqual','rootName','registerPostFixer','state','activeMarker','hasContent','top','editor','destroy','createElement','get','sort','comment:','getMarkersGroup','comment','isObject'];(function(_0x4b08d3,_0x5a7da4){const _0x36e198=function(_0x1e5dfc){while(--_0x1e5dfc){_0x4b08d3['push'](_0x4b08d3['shift']());}};_0x36e198(++_0x5a7da4);}(_0x5a7d,0x19f));const _0x36e1=function(_0x4b08d3,_0x5a7da4){_0x4b08d3=_0x4b08d3-0x0;let _0x36e198=_0x5a7d[_0x4b08d3];return _0x36e198;};import{Plugin as _0x5f5304}from'ckeditor5/src/core';import{Rect as _0x4ac2ea}from'ckeditor5/src/utils';import _0x325fe7 from'./commentsrepository';import _0x338796 from'./addcommentthreadcommand';import _0xe6a47a from'../utils/getmarkerdomelement';import _0x876afa from'./integrations/commentsrestrictededitingmode';import'../../theme/commentmarker.css';export default class r extends _0x5f5304{static get[_0x36e1('0x43')](){return[_0x325fe7,_0x876afa];}static get[_0x36e1('0x20')](){return _0x36e1('0x22');}constructor(_0x279635){super(_0x279635),this[_0x36e1('0x45')](_0x36e1('0x1a'),!0x0),_0x279635['data']['once']('ready',()=>this[_0x36e1('0x1a')]=!0x1),this[_0x36e1('0x45')](_0x36e1('0x8'),null),this['on']('change:activeMarker',(_0xa3418c,_0x2c948b,_0x251455,_0x414e52)=>{_0x279635[_0x36e1('0x1f')][_0x36e1('0x24')](_0x5f4a73=>{if(_0x251455){const {id:_0x5f19c1}=G(_0x251455),_0x52787f=this[_0x36e1('0x18')](_0x5f19c1);for(const _0xb1e2a5 of _0x52787f)_0x5f4a73[_0x36e1('0x3a')](_0xb1e2a5);}if(_0x414e52){const {id:_0x3480a8}=G(_0x414e52),_0x3a2c33=this[_0x36e1('0x18')](_0x3480a8);for(const _0x3c1d9b of _0x3a2c33)_0x5f4a73['updateMarker'](_0x3c1d9b);}});}),this['_attachedThreads']=new Set();}[_0x36e1('0x1d')](){const _0xc0225=this[_0x36e1('0xb')],_0x8eb12a=_0xc0225[_0x36e1('0x25')]['get']('CommentsRepository'),_0x14f5c8=_0xc0225[_0x36e1('0x3')]['get']('collaboration.channelId');_0xc0225[_0x36e1('0x1')][_0x36e1('0x29')](_0x36e1('0x36'),new _0x338796(_0xc0225)),this[_0x36e1('0x56')](_0xc0225,_0x36e1('0x41'),(_0x268078,_0xb3b1f7,_0x1f40cc)=>{_0x8eb12a[_0x36e1('0x37')](_0x1f40cc,_0xc0225[_0x36e1('0x3')]['get'](_0x36e1('0x2b')));}),this[_0x36e1('0x56')](_0x8eb12a,q('removeCommentThread',_0x14f5c8),(_0x5d13ac,{threadId:_0x165831})=>{_0xc0225[_0x36e1('0x1f')][_0x36e1('0x24')](_0x154750=>{for(const _0x45d4f7 of this['getAllMarkersForId'](_0x165831))_0x154750['removeMarker'](_0x45d4f7);});const _0x3457dc=_0x8eb12a['getCommentThread'](_0x165831);_0x8eb12a['hasCommentThread'](_0x165831)&&!_0x3457dc[_0x36e1('0x34')]||_0x5d13ac[_0x36e1('0x16')]();},{'priority':_0x36e1('0x4e')}),this[_0x36e1('0x56')](_0x8eb12a,q(_0x36e1('0x2'),_0x14f5c8),(_0x2c37da,{threadId:_0x414e4e,isFromAdapter:_0x424f31})=>{const _0x3b8052=this[_0x36e1('0x18')](_0x414e4e);if(_0x424f31||0x0==_0x3b8052[_0x36e1('0x34')]||!_0x8eb12a[_0x36e1('0x2e')](_0x414e4e))return;0x1===_0x8eb12a['getCommentThread'](_0x414e4e)[_0x36e1('0x34')]&&_0xc0225[_0x36e1('0x1f')][_0x36e1('0x24')](_0xfc4f59=>{for(const _0x7b0587 of _0x3b8052)_0xfc4f59[_0x36e1('0x3a')](_0x7b0587,{'usingOperation':!0x0,'affectsData':!0x0});});},{'priority':_0x36e1('0x4c')}),this[_0x36e1('0x3c')](),this['_handleMarkerAddAndRemove']();}[_0x36e1('0xc')](){const _0x1cc563=this['editor'][_0x36e1('0x25')][_0x36e1('0xe')]('CommentsRepository'),_0x3608cd=this['editor'][_0x36e1('0x3')][_0x36e1('0xe')]('collaboration.channelId');for(const _0x2b6200 of _0x1cc563['getCommentThreads']({'channelId':_0x3608cd}))_0x1cc563['_detachCommentThread'](_0x2b6200['id']),_0x1cc563['_threads']['delete'](_0x2b6200['id']);super[_0x36e1('0xc')]();}[_0x36e1('0x55')](_0x517fe7){return this['getAllMarkersForId'](_0x517fe7)[_0x36e1('0x34')]>0x0;}[_0x36e1('0x18')](_0xf72697){const _0x27babb=this['editor'][_0x36e1('0x1f')][_0x36e1('0x17')]['get']('comment:'+_0xf72697);return _0x27babb?[_0x27babb]:Array[_0x36e1('0x4f')](this[_0x36e1('0xb')]['model'][_0x36e1('0x17')][_0x36e1('0x11')](_0x36e1('0x10')+_0xf72697));}[_0x36e1('0x3c')](){const _0x59b508=this[_0x36e1('0xb')];_0x59b508[_0x36e1('0x48')][_0x36e1('0x3b')](_0x36e1('0x38'))[_0x36e1('0x4b')]({'model':_0x36e1('0x12'),'view':_0x3cbd47=>{const {id:_0x4a396b}=G(_0x3cbd47['markerName']),_0x34cfb1=['ck-comment-marker'];return this[_0x36e1('0x8')]&&G(this[_0x36e1('0x8')])['id']===_0x4a396b&&_0x34cfb1[_0x36e1('0x52')](_0x36e1('0x4a')),{'classes':_0x34cfb1,'attributes':{'data-comment':_0x4a396b}};}}),_0x59b508['conversion'][_0x36e1('0x3b')](_0x36e1('0x54'))[_0x36e1('0x21')]({'model':_0x36e1('0x12'),'view':_0x35e866=>{const _0x592cca=_0x59b508['model'][_0x36e1('0x17')]['get'](_0x35e866),{id:_0x3ba78b,part:_0x2d7b6a}=G(_0x35e866);return _0x592cca&&!_0x592cca[_0x36e1('0x4d')]?null:{'group':_0x36e1('0x12'),'name':_0x2d7b6a?_0x3ba78b+':'+_0x2d7b6a:_0x3ba78b};}}),_0x59b508[_0x36e1('0x48')][_0x36e1('0x3b')](_0x36e1('0x0'))[_0x36e1('0x1c')]({'view':{'name':'comment','attribute':{'id':/^\w/}},'model':(_0x5b5f1a,{writer:_0x179044})=>_0x179044[_0x36e1('0xd')]('$marker',{'data-name':_0x36e1('0x10')+_0x5b5f1a[_0x36e1('0x33')]('id')})}),_0x59b508['conversion'][_0x36e1('0x3b')](_0x36e1('0x0'))[_0x36e1('0x26')]({'view':_0x36e1('0x12')});}[_0x36e1('0x46')](){const _0x3c1725=this[_0x36e1('0xb')],_0x61c5e4=_0x3c1725[_0x36e1('0x25')][_0x36e1('0xe')](_0x36e1('0x27')),_0x35a1f7=new Set();_0x3c1725[_0x36e1('0x1f')][_0x36e1('0x28')][_0x36e1('0x6')](_0x584ec8=>{let _0x39632a=!0x1;for(const [_0x5a2ff0,_0x6a8c87]of _0x3c1725[_0x36e1('0x1f')][_0x36e1('0x28')][_0x36e1('0x44')]['_changedMarkers']){const {group:_0xfc28e5,id:_0x218f89}=G(_0x5a2ff0);let _0x1adadd=_0x6a8c87['newRange'];if(_0x36e1('0x12')!==_0xfc28e5||!_0x1adadd)continue;const _0x481ca9=_0x36e1('0x42')===_0x1adadd[_0x36e1('0x1b')][_0x36e1('0x5')];_0x481ca9||(_0x1adadd=H(_0x1adadd,_0x3c1725[_0x36e1('0x1f')]),!_0x1adadd||_0x1adadd[_0x36e1('0x4')](_0x6a8c87[_0x36e1('0x2c')]))?!_0x1adadd||!_0x3c1725['model'][_0x36e1('0x9')](_0x1adadd)||this['_attachedThreads'][_0x36e1('0x31')](_0x218f89)&&_0x481ca9?(_0x584ec8['removeMarker'](_0x5a2ff0),_0x39632a=!0x0):_0x481ca9||(this[_0x36e1('0x1a')]?_0x35a1f7['add'](_0x218f89):this[_0x36e1('0x2a')](_0x218f89)):(_0x584ec8[_0x36e1('0x3a')](_0x5a2ff0,{'range':_0x1adadd}),_0x39632a=!0x0);}return _0x39632a;}),this['on'](_0x36e1('0x19'),(_0x233468,_0x4ce5e5,_0x146c6a)=>{if(!_0x146c6a&&_0x35a1f7[_0x36e1('0x53')])for(const _0x3c58a3 of _0x35a1f7)this[_0x36e1('0x2a')](_0x3c58a3),_0x35a1f7[_0x36e1('0x47')](_0x3c58a3);}),this[_0x36e1('0x56')](_0x3c1725[_0x36e1('0x1f')][_0x36e1('0x17')],'update:comment',(_0x918540,_0x105238,_0x5d4e1e,_0x380c4c)=>{if(_0x380c4c)return;const {id:_0x4bb8ef}=G(_0x105238[_0x36e1('0x3e')]),_0x42dd51=_0x3c1725[_0x36e1('0x25')][_0x36e1('0xe')](_0x36e1('0x27'))['getCommentThread'](_0x4bb8ef);_0x35a1f7[_0x36e1('0x47')](_0x4bb8ef),_0x42dd51&&!this[_0x36e1('0x55')](_0x4bb8ef)&&(this[_0x36e1('0x23')][_0x36e1('0x47')](_0x4bb8ef),_0x61c5e4['_detachCommentThread'](_0x4bb8ef));});}[_0x36e1('0x2a')](_0x498c48){if(this[_0x36e1('0x23')][_0x36e1('0x31')](_0x498c48))return;this[_0x36e1('0x23')][_0x36e1('0x29')](_0x498c48);const _0x48ff3c=this[_0x36e1('0xb')],_0x21fde9=_0x48ff3c[_0x36e1('0x25')][_0x36e1('0xe')](_0x36e1('0x27')),_0x2f08b6=_0x48ff3c[_0x36e1('0x3')][_0x36e1('0xe')](_0x36e1('0x2b')),_0x263214=()=>{const _0x2be9a6=this[_0x36e1('0x18')](_0x498c48);if(0x0==_0x2be9a6[_0x36e1('0x34')])return null;const _0x234b50=_0x2be9a6['map'](_0x1fc5eb=>_0xe6a47a(_0x48ff3c[_0x36e1('0x3f')],_0x1fc5eb));return _0x234b50[_0x36e1('0xf')]((_0x5a4c8c,_0x5e950c)=>{const _0x4e7f30=new _0x4ac2ea(_0x5a4c8c),_0x51317d=new _0x4ac2ea(_0x5e950c),_0x248d40=_0x4e7f30[_0x36e1('0xa')]-_0x51317d[_0x36e1('0xa')];return 0x0==_0x248d40?_0x4e7f30[_0x36e1('0x15')]-_0x51317d[_0x36e1('0x15')]:_0x248d40;}),_0x234b50[0x0];};!this[_0x36e1('0x18')](_0x498c48)[0x0][_0x36e1('0x14')]?_0x48ff3c['editing'][_0x36e1('0x32')][_0x36e1('0x1e')]('render',()=>{_0x21fde9[_0x36e1('0x30')]({'channelId':_0x2f08b6,'threadId':_0x498c48,'target':_0x263214});},{'priority':_0x36e1('0x4c')}):_0x21fde9[_0x36e1('0x2d')]({'channelId':_0x2f08b6,'threadId':_0x498c48})['then'](_0x3f0932=>{if('destroyed'!==_0x48ff3c[_0x36e1('0x7')]){if(_0x3f0932)_0x3f0932[_0x36e1('0x50')](_0x263214);else{const _0x427150=this[_0x36e1('0x18')](_0x498c48);_0x48ff3c['model'][_0x36e1('0x24')](_0x453015=>{for(const _0x3dbca9 of _0x427150)_0x453015[_0x36e1('0x35')](_0x3dbca9);});}}});}}function q(_0x68d7bb,_0x5d0c96){return _0x5d0c96?_0x68d7bb+':'+_0x5d0c96:_0x68d7bb;}function G(_0x3ec8d0){const _0x75eab5=_0x3ec8d0['split'](':');return{'group':_0x75eab5[0x0],'id':_0x75eab5[0x1],'part':_0x75eab5[0x2]};}function H(_0x29a52f,_0x2077dc){const _0xf762b5=_0x2077dc[_0x36e1('0x40')],_0x189ce3=_0x2077dc[_0x36e1('0x49')](_0x29a52f[_0x36e1('0x39')]);for(const _0x308c91 of _0x29a52f[_0x36e1('0x51')]()){const {type:_0x35bbee,item:_0x4f8575,nextPosition:_0x211fea}=_0x308c91;if('text'===_0x35bbee||_0xf762b5[_0x36e1('0x13')](_0x4f8575)){const _0x32bca3=_0x2077dc[_0x36e1('0x2f')](_0x4f8575);_0x189ce3[_0x36e1('0x3d')]&&(_0x189ce3[_0x36e1('0x39')]=_0x32bca3),_0x189ce3['end']=_0x211fea;}}return _0x189ce3[_0x36e1('0x3d')]?null:_0x189ce3;}