/*
 *             Copyright (c) 2016 - 2022, CKSource Holding sp. z o.o. All rights reserved.
 *
 *
 *
 *
 *          +---------------------------------------------------------------------------------+
 *          |                                                                                 |
 *          |                                 Hello stranger!                                 |
 *          |                                                                                 |
 *          |                                                                                 |
 *          |   What you're currently looking at is the source code of a legally protected,   |
 *          |    proprietary software. Any attempts to deobfuscate / disassemble this code    |
 *          |               are forbidden and will result in legal consequences.              |
 *          |                                                                                 |
 *          |                                                                                 |
 *          +---------------------------------------------------------------------------------+
 *
 *
 *
 *
 */
const _0x49a0=['add','plugins','getByView','_manuallyClosed','get','setActiveAnnotation','inlineannotations-not-allowed-with-context','_addedAnnotations','activeAnnotation','stopListening','hasView','change:visibleView','set','targetRect','listenTo','_removeAnnotationFromBalloon','blur','isAttached','hasActive','mousedown','focus','_annotations','editing','visibleView','inline','bind','context','focusTracker','refresh','attach','showStack','has','includes','EditorAnnotations','editor','_selectedAnnotations','remove','requires','Esc','InlineAnnotations','document','inlineannotations-detach-not-attached','keystrokes','change:isFocused','delete','detach','editableElement','init','_addAnnotationToBalloon','register','isActive','isFocused','switchTo','view','_setSelectedAnnotations','_balloon','afterInit','clear','destroy','updatePosition'];(function(_0xfcc72,_0x49a0c6){const _0x4fc040=function(_0x2ec178){while(--_0x2ec178){_0xfcc72['push'](_0xfcc72['shift']());}};_0x4fc040(++_0x49a0c6);}(_0x49a0,0x68));const _0x4fc0=function(_0xfcc72,_0x49a0c6){_0xfcc72=_0xfcc72-0x0;let _0x4fc040=_0x49a0[_0xfcc72];return _0x4fc040;};import{Plugin as _0x387b2a}from'ckeditor5/src/core';import _0x3d314a from'./annotationsuis';import _0x144cb7 from'./editorannotations';import{ContextualBalloon as _0x4c6882}from'ckeditor5/src/ui';import{MouseObserver as _0x378e8d}from'ckeditor5/src/engine';import{CKEditorError as _0x5d95e0}from'ckeditor5/src/utils';import'./../../theme/annotation-inline.css';export default class a extends _0x387b2a{static get[_0x4fc0('0x35')](){return[_0x144cb7,_0x4c6882,_0x3d314a];}static get['pluginName'](){return _0x4fc0('0x37');}constructor(_0x3ad8a7){super(_0x3ad8a7),_0x3ad8a7['editing']['view']['addObserver'](_0x378e8d),this['isAttached']=!0x1,this[_0x4fc0('0x1c')](_0x4fc0('0x18'),null),this[_0x4fc0('0x25')]=null,this[_0x4fc0('0x13')]=new Set(),this[_0x4fc0('0xb')]=_0x3ad8a7[_0x4fc0('0x11')][_0x4fc0('0x14')](_0x4c6882),this['_addedAnnotations']=new Set(),this[_0x4fc0('0x33')]=[];}[_0x4fc0('0x3')](){const _0xce2646=this[_0x4fc0('0x32')][_0x4fc0('0x11')]['get'](_0x3d314a);_0xce2646['context']===this['editor']&&(_0xce2646[_0x4fc0('0x5')](_0x4fc0('0x28'),this),this[_0x4fc0('0x32')][_0x4fc0('0x3a')][_0x4fc0('0x1c')]('Esc',(_0x13182f,_0x818708)=>{const _0x375665=this[_0x4fc0('0xb')];if(this[_0x4fc0('0x21')]&&_0x375665['visibleView']){const _0x267caf=this['_annotations'][_0x4fc0('0x12')](_0x375665[_0x4fc0('0x27')]);this[_0x4fc0('0x13')][_0x4fc0('0x10')](_0x267caf),this[_0x4fc0('0x1f')](_0x267caf),_0x818708();}}));}[_0x4fc0('0xc')](){const _0x328ba0=this[_0x4fc0('0x32')][_0x4fc0('0x11')][_0x4fc0('0x14')](_0x3d314a);_0x328ba0['context']===this[_0x4fc0('0x32')]&&(_0x328ba0[_0x4fc0('0x22')]()||_0x328ba0[_0x4fc0('0x8')](_0x4fc0('0x28')));}[_0x4fc0('0x15')](_0x1a5782){_0x1a5782!==this[_0x4fc0('0x18')]&&(this[_0x4fc0('0x18')]&&(this[_0x4fc0('0x18')][_0x4fc0('0x6')]=!0x1),_0x1a5782&&this[_0x4fc0('0x32')]['ui']['focusTracker'][_0x4fc0('0x7')]&&(this[_0x4fc0('0x4')](_0x1a5782,!0x0),_0x1a5782['isActive']=!0x0),_0x1a5782||this[_0x4fc0('0xa')]([]),this[_0x4fc0('0x18')]=_0x1a5782);}[_0x4fc0('0x2d')](_0x9a7996){this[_0x4fc0('0x25')]=_0x9a7996;const _0x5b7a99=this[_0x4fc0('0x32')][_0x4fc0('0x11')][_0x4fc0('0x14')](_0x3d314a),_0x310253=this[_0x4fc0('0xb')];if(this['isAttached'])throw new _0x5d95e0('inlineannotations-attach-already-attached',this);if(_0x5b7a99[_0x4fc0('0x2a')]!==this[_0x4fc0('0x32')])throw new _0x5d95e0(_0x4fc0('0x16'),this);const _0x2e4aea=this[_0x4fc0('0x32')]['plugins'][_0x4fc0('0x14')](_0x4fc0('0x31'));this[_0x4fc0('0x1e')](_0x2e4aea,_0x4fc0('0x2c'),function(){const _0x2fc8d5=_0x2e4aea['getOrderedSelectedAnnotations']({'activeAnnotation':this[_0x4fc0('0x18')],'annotations':this[_0x4fc0('0x25')]});this[_0x4fc0('0xa')](_0x2fc8d5),this[_0x4fc0('0x15')](_0x2fc8d5[0x0]||null);}[_0x4fc0('0x29')](this)),this[_0x4fc0('0x1e')](_0x2e4aea,_0x4fc0('0x20'),(_0x2b9d1d,{isAnnotationTracked:_0x10c8c1})=>{this[_0x4fc0('0x18')]&&_0x10c8c1(this[_0x4fc0('0x18')])&&(this[_0x4fc0('0xa')]([]),this[_0x4fc0('0x15')](null));}),this[_0x4fc0('0x1e')](this[_0x4fc0('0x32')]['ui']['focusTracker'],_0x4fc0('0x3b'),(_0x438eb7,_0x22c2d1,_0x465971)=>{_0x465971||this['setActiveAnnotation'](null);}),this[_0x4fc0('0x1e')](_0x9a7996,_0x4fc0('0x34'),(_0x1b74a0,_0x107d4e)=>{this[_0x4fc0('0x1f')](_0x107d4e),_0x107d4e===this[_0x4fc0('0x18')]&&this[_0x4fc0('0x15')](null);}),this[_0x4fc0('0x1e')](_0x310253,_0x4fc0('0x1b'),(_0xeb4b35,_0x410731,_0x5891a3,_0x26428b)=>{if(_0x26428b&&this[_0x4fc0('0x19')](_0x26428b),!_0x5891a3||!_0x9a7996['getByView'](_0x5891a3))return;const _0x46e68c=_0x9a7996[_0x4fc0('0x12')](_0x5891a3);this[_0x4fc0('0x1e')](_0x5891a3,'change:height',()=>{_0x310253[_0x4fc0('0xf')]();}),this[_0x4fc0('0x1e')](_0x5891a3,_0x4fc0('0x36'),()=>{this[_0x4fc0('0x13')][_0x4fc0('0x10')](_0x46e68c),this[_0x4fc0('0x1f')](_0x46e68c),this[_0x4fc0('0x32')][_0x4fc0('0x26')][_0x4fc0('0x9')][_0x4fc0('0x24')]();}),this['activeAnnotation']!==_0x46e68c&&this['setActiveAnnotation'](_0x46e68c);}),this[_0x4fc0('0x1e')](this['editor']['ui'],'update',()=>{_0x310253[_0x4fc0('0x27')]&&(_0x9a7996[_0x4fc0('0x12')](_0x310253['visibleView'])&&_0x310253[_0x4fc0('0xf')]());}),this['listenTo'](this[_0x4fc0('0x32')][_0x4fc0('0x26')][_0x4fc0('0x9')][_0x4fc0('0x38')],_0x4fc0('0x23'),()=>{this[_0x4fc0('0x13')][_0x4fc0('0xd')]();}),this[_0x4fc0('0x32')]['editing'][_0x4fc0('0x9')]['document']['selection'][_0x4fc0('0x2')]&&this[_0x4fc0('0x32')][_0x4fc0('0x26')][_0x4fc0('0x9')]['focus'](),this['isAttached']=!0x0;}[_0x4fc0('0x1')](){if(!this[_0x4fc0('0x21')])throw new _0x5d95e0(_0x4fc0('0x39'),this);this[_0x4fc0('0x15')](null);for(const _0x2aa29b of this[_0x4fc0('0x17')])this['_removeAnnotationFromBalloon'](_0x2aa29b);this[_0x4fc0('0x19')](),this['isAttached']=!0x1;}[_0x4fc0('0xe')](){this[_0x4fc0('0x21')]&&this[_0x4fc0('0x1')]();}[_0x4fc0('0xa')](_0x3081e7){const _0x3e305b=this['_selectedAnnotations'];for(const _0x3700f4 of _0x3e305b)_0x3081e7[_0x4fc0('0x30')](_0x3700f4)||this['_manuallyClosed'][_0x4fc0('0x0')](_0x3700f4);for(const _0x222052 of this[_0x4fc0('0x25')])_0x3081e7[_0x4fc0('0x30')](_0x222052)||this[_0x4fc0('0x1f')](_0x222052);if(this[_0x4fc0('0x32')]['ui'][_0x4fc0('0x2b')][_0x4fc0('0x7')])for(const _0x27195e of _0x3081e7)this[_0x4fc0('0x4')](_0x27195e);this[_0x4fc0('0x33')]=_0x3081e7;}[_0x4fc0('0x4')](_0x4529cb,_0x1e47c6){this[_0x4fc0('0x13')][_0x4fc0('0x2f')](_0x4529cb)||(this['_addedAnnotations'][_0x4fc0('0x2f')](_0x4529cb)||this['_balloon'][_0x4fc0('0x1a')](_0x4529cb[_0x4fc0('0x9')])||(this[_0x4fc0('0x17')][_0x4fc0('0x10')](_0x4529cb),this[_0x4fc0('0xb')][_0x4fc0('0x10')]({'stackId':_0x4529cb[_0x4fc0('0x9')]['id'],'view':_0x4529cb[_0x4fc0('0x9')],'position':{'target':()=>_0x4529cb['target']||_0x4529cb[_0x4fc0('0x1d')]||document['getSelection']()['getRangeAt'](0x0)}})),_0x1e47c6&&this[_0x4fc0('0xb')][_0x4fc0('0x2e')](_0x4529cb['view']['id']));}[_0x4fc0('0x1f')](_0x1e1bb1){this[_0x4fc0('0x17')][_0x4fc0('0x2f')](_0x1e1bb1)&&this[_0x4fc0('0xb')][_0x4fc0('0x1a')](_0x1e1bb1[_0x4fc0('0x9')])&&(this[_0x4fc0('0x17')][_0x4fc0('0x0')](_0x1e1bb1),this[_0x4fc0('0xb')][_0x4fc0('0x34')](_0x1e1bb1[_0x4fc0('0x9')]));}}